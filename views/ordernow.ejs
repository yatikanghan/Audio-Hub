<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AudioHub - Premium Audio Equipment</title>
    <link rel="stylesheet" href="/css/main.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body>
    <%- include('header.ejs') %>
    
    <div class="container">
        <div class="row">
            <div class="ordertitle text-center" style="margin-top: 70px; margin-bottom: 100px;">
                <div class="form-header">
                    <h2><i class="fas fa-shopping-cart me-2"></i> Order Now</h2>
                    <p class="text-muted">Complete your purchase by filling out the form below</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="orderform">                
                <div class="col-lg-6 col-md-12 col-sm-12 offset-lg-3 offset-md-0 offset-sm-0">
                    <form action="/order/Checkout" method="post" novalidate>
                        <div class="form-section">
                            <h4 class="section-title"><i class="fas fa-box me-2"></i>Product Information</h4>
                            <input type="hidden" name="productId" value="<%= product._id %>">
                            <div class="product-info">
                                <img src="<%= product.image.img1 %>" alt="Product Image" class="product-image" style="object-fit: contain;">
                                        
                                <div class="flex-grow-1">
                                    <h5><%= product.name %></h5>
                                    <p class="text-muted mb-0">SKU: <%= product.sku %></p>
                                    <p class="mb-0"><%= product.price %>.00 €</p>
                                </div>
                            </div>
            
                            <div class="mb-3">
                                <label class="form-label">Quantity</label>
                                <div>
                                    <button type="button" style="width: auto; height: auto; background: none; border: 0;" onclick="increaseQty()"><img src="/images/plus.png" alt="" height="32px" width="32px"></button>
                                    <input type="number" class="qtyin" name="qty" id="qty" value="1" min="1" max="10" readonly style="text-align: center;">
                                    <button type="button" style="width: auto; height: auto; background: none; border: 0;" onclick="decreaseQty()"><img src="/images/minus.png" alt="" height="32px" width="32px"></button>
                                </div>
                                <div class="form-text">Maximum 10 items per order</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Total Amount</label>
                                <p id="txttotalamount" style="color: rgb(122, 0, 0);">24.00 €</p>
                            </div>
                            <br><br>
                            <h4 class="section-title"><i class="fas fa-box me-2"></i>Shipping Information</h4>

                            <div class="row">
                                <div class="col-lg-12 col-md-12 mb-3">
                                    <label for="address" class="form-label">Address</label>
                                    <input type="text" class="form-control" id="address" name="address" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" name="city" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="postcode" class="form-label">Postal Code</label>
                                    <input type="text" class="form-control" id="postcode" name="postcode" required>
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label for="country" class="form-label">Country</label>
                                    <input type="text" class="form-control" id="country" name="country" required>
                                </div>
                                <h4 class="section-title mt-5"><i class="fas fa-box me-2"></i>Payment Information</h4>
                                <div class="mb-3">
                                    <label for="cardName" class="form-label">Cardholder Name</label>
                                    <input type="text" class="form-control" id="cardName" name="cardName" required>
                                    <div class="invalid-feedback">Please enter the cardholder's name.</div>
                                  </div>
                            
                                  <!-- Card Number -->
                                  <div class="mb-3" novalidate>
                                    <label for="cardNumber" class="form-label">Card Number</label>
                                    <input type="text" class="form-control" id="cardNumber" name="cardNumber" maxlength="16" pattern="\d{16}">
                                    <div class="invalid-feedback">Please enter a valid 16-digit card number.</div>
                                  </div>
                                  
                                  <!-- Expiration Date -->
                                  <div class="mb-3">
                                    <label for="expDate" class="form-label">Expiration Date (MM/YY)</label>
                                    <input type="text" class="form-control" id="expDate" name="expDate" placeholder="MM/YY" pattern="^(0[1-9]|1[0-2])\/?([0-9]{2})$" required>
                                    <div class="invalid-feedback">Please enter a valid expiration date (MM/YY).</div>
                                  </div>
                            
                                  <!-- CVV -->
                                  <div class="mb-3">
                                    <label for="cvv" class="form-label">CVV</label>
                                    <input type="password" class="form-control" id="cvv" name="cvv" maxlength="4" pattern="\d{3,4}" required>
                                    <div class="invalid-feedback">Please enter a valid 3 or 4-digit CVV.</div>
                                  </div>

                                <br><br>
                                <div style="display: flex; flex-direction: column-reverse; margin-top: 50px; margin-bottom: 100px;">
                                    <button type="submit" class="btncheckout" style="background-color: rgb(225, 146, 0);">Pay Now</button>
                                </div>
                                <br><br>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <br><br><br><br>



    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="/js/style.js"></script>
    <script>
        const pricePerItem = parseFloat('<%= product.price %>') || 0;
        document.getElementById("txttotalamount").innerText = parseFloat(parseFloat(pricePerItem) * parseFloat(document.getElementById("qty").value)) + ".00 €";


        document.addEventListener("DOMContentLoaded", function () {
          const form = document.querySelector("form");
        
          form.addEventListener("submit", function (e) {
            let isValid = true;
        
            // Quantity
            const qty = document.getElementById("qty");
            if (!qty.value || qty.value < 1 || qty.value > 10) {
              isValid = false;
              qty.classList.add("is-invalid");
            } else {
              qty.classList.remove("is-invalid");
            }
        
            // Address
            const address = document.getElementById("address");
            if (address.value.trim().length < 5) {
              isValid = false;
              address.classList.add("is-invalid");
            } else {
              address.classList.remove("is-invalid");
            }
        
            // City
            const city = document.getElementById("city");
            if (city.value.trim().length < 2) {
              isValid = false;
              city.classList.add("is-invalid");
            } else {
              city.classList.remove("is-invalid");
            }
        
            // Postcode (5 digits)
            const postcode = document.getElementById("postcode");
            const postcodePattern = /^[0-9]{4,6}$/;
            if (!postcodePattern.test(postcode.value)) {
              isValid = false;
              postcode.classList.add("is-invalid");
            } else {
              postcode.classList.remove("is-invalid");
            }
        
            // Country
            const country = document.getElementById("country");
            if (country.value.trim().length < 2) {
              isValid = false;
              country.classList.add("is-invalid");
            } else {
              country.classList.remove("is-invalid");
            }
        
            // Cardholder Name
            const cardName = document.getElementById("cardName");
            if (cardName.value.trim().length < 3) {
              isValid = false;
              cardName.classList.add("is-invalid");
            } else {
              cardName.classList.remove("is-invalid");
            }
        
            // Card Number (16 digits)
            const cardNumber = document.getElementById("cardNumber");
            const cardNumberPattern = /^\d{16}$/;
            if (!cardNumberPattern.test(cardNumber.value)) {
              isValid = false;
              cardNumber.classList.add("is-invalid");
            } else {
              cardNumber.classList.remove("is-invalid");
            }
        
            // Expiry Date (MM/YY)
            const expDate = document.getElementById("expDate");
            const expPattern = /^(0[1-9]|1[0-2])\/\d{2}$/;
            if (!expPattern.test(expDate.value)) {
              isValid = false;
              expDate.classList.add("is-invalid");
            } else {
              expDate.classList.remove("is-invalid");
            }
        
            // CVV (3-4 digits)
            const cvv = document.getElementById("cvv");
            const cvvPattern = /^\d{3,4}$/;
            if (!cvvPattern.test(cvv.value)) {
              isValid = false;
              cvv.classList.add("is-invalid");
            } else {
              cvv.classList.remove("is-invalid");
            }
        
            // Prevent submission if invalid
            if (!isValid) {
              e.preventDefault();
              e.stopPropagation();
              alert("Please fill all fields correctly before submitting.");
            }
          });
        });
        
        function increaseQty() {
        const qtyInput = document.getElementById("qty");
        let currentValue = parseInt(qtyInput.value) || 0;
        if (currentValue < parseInt(qtyInput.max)) {
            qtyInput.value = currentValue + 1;
            
        }
        
        document.getElementById("txttotalamount").innerText = parseFloat(parseFloat(pricePerItem) * parseFloat(document.getElementById("qty").value)) + ".00 €";
        }

        function decreaseQty() {
        const qtyInput = document.getElementById("qty");
        let currentValue = parseInt(qtyInput.value) || 0;
        if (currentValue > parseInt(qtyInput.min)) 
        {
            qtyInput.value = currentValue - 1;
        }
        
        document.getElementById("txttotalamount").innerText = parseFloat(parseFloat(pricePerItem) * parseFloat(document.getElementById("qty").value)) + ".00 €";
        }
        </script>
</body>
</html>